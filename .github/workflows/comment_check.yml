name: Update README from Issue Comment

on:
  issue_comment:
    types: [created]

jobs:
  update_readme:
    runs-on: ubuntu-latest

    steps:
      - name: Check if Command is Issued
        id: check_command
        if: startsWith(github.event.comment.body, '/update-readme')
        run: echo "::set-output name=command::update-readme"

      - name: Extract Content
        id: extract_content
        if: steps.check_command.outputs.command == 'update-readme'
        run: echo "${{ github.event.comment.body }}" | cut -d' ' -f2-
        env:
          COMMENT_BODY: ${{ github.event.comment.body }}

      - name: Checkout code
        if: steps.check_command.outputs.command == 'update-readme'
        uses: actions/checkout@v2

      - name: pwd
        run: |
          pwd
          tree
          cd .github/workflows
          ls

      - name: Call Manage README Workflow
        if: steps.check_command.outputs.command == 'update-readme'
        uses: .github/workflows/manage_readme.yml
        with:
          action: 'append'
          content: |
            - User: ${{ github.event.comment.user.login }}
            - Content: ${{ steps.extract_content.outputs.comment_body }}
          replace_pattern: ''
